{% extends 'base.html.twig' %}

{% block body %}
    <!-- Basic Example | Horizontal Layout -->
    <div class="row clearfix">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card">
                <div class="header">
                    <h2>
                        <b>{{ data['symbol'] }}</b> RULE (<span
                                id="{{ data['symbol'] | lower }}">{{ data['price'] }}</span>)
                    </h2>

                </div>
                <div class="body">
                    <form method="post" action="{{ path('binance-post-edit-rule', {symbol: data['symbol'], id: rule.id}) }}">
                        <label for="api_key">Btc Price</label>
                        <div class="form-group">
                            <div class="form-line">
                                <input type="text" id="binance-api-key" name="price" class="form-control"
                                       value="{{ rule.price }}">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary m-t-15 waves-effect">SAVE
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block javascripts %}
    <script src="{{ asset("assets/plugins/jquery-validation/jquery.validate.js") }}"></script>
    <script src="{{ asset("assets/plugins/sweetalert/sweetalert.min.js") }}"></script>
    <script src="{{ asset("assets/js/demo.js") }}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var symbol = "{{ data['symbol'] }}";
            var url = "wss://stream.binance.com:9443/ws/" + symbol.toLowerCase() + "@aggTrade";
            var prices = [];
            w = new WebSocket(url);
            w.onopen = function () {
                //console.log('OPENED!');
            };
            w.onmessage = function (e) {
                var data = JSON.parse(e.data.toString());
                if (!prices[symbol]) {
                    prices[symbol] = data.p;
                } else {
                    if (prices[symbol] > data.p) {
                        $('#' + symbol.toLowerCase()).text(data.p).css('color', '#FD3F32');
                    } else {
                        $('#' + symbol.toLowerCase()).text(data.p).css('color', '#39FD32');
                    }
                }
            };
        });
    </script>
{% endblock %}